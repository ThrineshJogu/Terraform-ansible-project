pipeline {
    agent any
    stages {
        stage('terrafrom') {
            steps {
                git branch: 'main', url: 'https://github.com/ThrineshJogu/Terraform-ansible-project.git'
            }
        }
        stage('init'){
            steps{
                sh 'echo -e "yes\n" terraform init'
            }
        }
        stage('plan'){
            steps{
                sh 'terraform plan'
            }
        }
        stage('apply'){
            steps{
                sh 'terraform $choice --auto-approve'
            }
        }
        stage('Deploy'){
            steps{
                sh 'ansible-playbook -i /opt/ansible/inventory/aws_ec2.yml /var/lib/jenkins/workspace/MyDeployment/ansible'
            }
        }
        
    }
}








ansible configurations
cd /etc/ansible
vi ansible.cfg

[default]
inventory = /opt/ansible/inventory/aws_ec2.yml
host_key_checking= false
[plugins]
enable_plugins= aws_ec2

vi mykey.pem # place pem key

mkdir -p /opt/ansible/inventory
cd /opt/ansible/inventory

vi aws_ec2.yml

---
plugin: aws_ec2
regions:
  - eu-north-1
filters:
  tag: aws:autoscaling:groupName:web-server-asg #give terraform create ec2 tag here



